{"version":3,"file":"emoticon-replacer.umd.min.js","sources":["../src/core/EmoticonReplacer.js","../src/core/SearchEngine.js","../src/core/EmoticonDataManager.js","../src/storage/IndexedDBStorage.js","../index.js"],"sourcesContent":["/**\n * EmoticonReplacer.js\n * 核心替换引擎 - 可独立使用，不依赖任何框架\n * 负责检测文本中的标记并替换为对应的 emoticon\n */\n\nclass EmoticonReplacer {\n    constructor(searchEngine) {\n        this.searchEngine = searchEngine;\n\n        // 标记格式配置\n        this.config = {\n            // 标记的正则表达式: [emoticon:关键词1,关键词2,...]\n            markerPattern: /\\[emoticon:([^\\]]+)\\]/gi,\n            // 分隔符\n            keywordSeparator: ',',\n            // 替换策略: 'first' | 'best' | 'all'\n            replaceStrategy: 'best'\n        };\n    }\n\n    /**\n     * 设置配置\n     * @param {Object} config - 配置对象\n     */\n    setConfig(config) {\n        Object.assign(this.config, config);\n    }\n\n    /**\n     * 加载 emoticon 数据\n     * @param {Array} emoticons - emoticon 数据数组\n     */\n    loadEmoticons(emoticons) {\n        this.searchEngine.buildIndex(emoticons);\n    }\n\n    /**\n     * 处理文本，替换所有标记为 emoticon\n     * @param {string} text - 输入文本\n     * @param {Object} options - 替换选项\n     * @returns {Object} 包含替换后的文本和替换信息\n     */\n    replaceText(text, options = {}) {\n        const {\n            strategy = this.config.replaceStrategy,\n            threshold = 0,\n            keepOriginalOnNotFound = true,\n            markNotFound = false\n        } = options;\n\n        let result = text;\n        const replacements = [];\n        let matchIndex = 0;\n\n        // 查找所有标记\n        result = result.replace(this.config.markerPattern, (match, keywordsStr, offset) => {\n            // 解析关键词\n            const keywords = keywordsStr\n                .split(this.config.keywordSeparator)\n                .map(k => k.trim())\n                .filter(k => k.length > 0);\n\n            if (keywords.length === 0) {\n                return keepOriginalOnNotFound ? match : '';\n            }\n\n            // 搜索匹配的 emoticon\n            const searchText = keywords.join(' ');\n            const matches = this.searchEngine.search(searchText, 5, threshold);\n\n            let replacement = '';\n            let selectedEmoticon = null;\n\n            if (matches.length > 0) {\n                // 根据策略选择 emoticon\n                switch (strategy) {\n                    case 'first':\n                        selectedEmoticon = matches[0];\n                        replacement = matches[0].emoticon;\n                        break;\n\n                    case 'best':\n                        // 选择分数最高的\n                        selectedEmoticon = matches[0];\n                        replacement = matches[0].emoticon;\n                        break;\n\n                    case 'all':\n                        // 返回所有匹配的 emoticon\n                        replacement = matches.map(m => m.emoticon).join(' ');\n                        selectedEmoticon = matches;\n                        break;\n\n                    default:\n                        selectedEmoticon = matches[0];\n                        replacement = matches[0].emoticon;\n                }\n\n                // 记录替换信息\n                replacements.push({\n                    index: matchIndex++,\n                    original: match,\n                    keywords: keywords,\n                    emoticon: replacement,\n                    offset: offset,\n                    matches: matches,\n                    selected: selectedEmoticon\n                });\n\n                return replacement;\n            } else {\n                // 没有找到匹配的 emoticon\n                replacements.push({\n                    index: matchIndex++,\n                    original: match,\n                    keywords: keywords,\n                    emoticon: null,\n                    offset: offset,\n                    matches: [],\n                    selected: null,\n                    notFound: true\n                });\n\n                if (markNotFound) {\n                    return `[?${keywordsStr}]`;\n                }\n\n                return keepOriginalOnNotFound ? match : '';\n            }\n        });\n\n        return {\n            text: result,\n            replacements: replacements,\n            originalText: text,\n            hasReplacements: replacements.length > 0,\n            successCount: replacements.filter(r => !r.notFound).length,\n            failureCount: replacements.filter(r => r.notFound).length\n        };\n    }\n\n    /**\n     * 批量替换多个文本\n     * @param {Array} texts - 文本数组\n     * @param {Object} options - 替换选项\n     * @returns {Array} 替换结果数组\n     */\n    replaceMultiple(texts, options = {}) {\n        return texts.map(text => this.replaceText(text, options));\n    }\n\n    /**\n     * 预览替换结果（不实际替换，只返回会被替换的内容）\n     * @param {string} text - 输入文本\n     * @returns {Array} 预览结果数组\n     */\n    preview(text) {\n        const markers = [];\n        let match;\n\n        const regex = new RegExp(this.config.markerPattern);\n        while ((match = regex.exec(text)) !== null) {\n            const keywordsStr = match[1];\n            const keywords = keywordsStr\n                .split(this.config.keywordSeparator)\n                .map(k => k.trim())\n                .filter(k => k.length > 0);\n\n            const searchText = keywords.join(' ');\n            const matches = this.searchEngine.search(searchText, 5, 0);\n\n            markers.push({\n                marker: match[0],\n                keywords: keywords,\n                offset: match.index,\n                matches: matches,\n                bestMatch: matches.length > 0 ? matches[0] : null\n            });\n        }\n\n        return markers;\n    }\n\n    /**\n     * 查询关键词对应的 emoticon（不需要标记格式）\n     * @param {string} keywords - 关键词字符串\n     * @param {number} topK - 返回前 K 个结果\n     * @returns {Array} 匹配结果\n     */\n    query(keywords, topK = 5) {\n        return this.searchEngine.search(keywords, topK, 0);\n    }\n\n    /**\n     * 精确查询（使用关键词完全匹配）\n     * @param {string} keywords - 关键词字符串\n     * @returns {Array} 精确匹配结果\n     */\n    exactQuery(keywords) {\n        return this.searchEngine.exactMatch(keywords);\n    }\n\n    /**\n     * 获取统计信息\n     * @returns {Object} 统计数据\n     */\n    getStats() {\n        return {\n            totalEmoticons: this.searchEngine.documents.length,\n            avgDocLength: this.searchEngine.avgDocLength,\n            config: { ...this.config }\n        };\n    }\n}\n\n// 导出（支持 CommonJS 和 ES6）\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = EmoticonReplacer;\n}\nif (typeof window !== 'undefined') {\n    window.EmoticonReplacer = EmoticonReplacer;\n}\n","/**\n * SearchEngine.js\n * 基于 BM25 算法的关键词搜索引擎\n * 用于在文本中查找和评分关键词匹配\n */\n\nclass SearchEngine {\n    constructor(config = {}) {\n        // BM25 参数\n        this.k1 = config.k1 || 1.5;  // 词频饱和参数\n        this.b = config.b || 0.75;   // 长度归一化参数\n\n        // 索引数据\n        this.documents = [];         // 文档列表（每个emoticon的keywords作为一个文档）\n        this.avgDocLength = 0;       // 平均文档长度\n        this.idf = new Map();        // IDF 值缓存\n    }\n\n    /**\n     * 构建索引\n     * @param {Array} emoticons - emoticon 数据数组\n     */\n    buildIndex(emoticons) {\n        this.documents = emoticons.map(item => ({\n            emoticon: item.emoticon,\n            keywords: [...item.keywords],\n            weight: item.weight || 1.0,\n            category: item.category || ''\n        }));\n\n        // 计算平均文档长度\n        const totalLength = this.documents.reduce((sum, doc) =>\n            sum + doc.keywords.length, 0);\n        this.avgDocLength = totalLength / this.documents.length;\n\n        // 计算 IDF\n        this._calculateIDF();\n    }\n\n    /**\n     * 计算 IDF (Inverse Document Frequency)\n     */\n    _calculateIDF() {\n        const termDocCount = new Map();\n        const N = this.documents.length;\n\n        // 统计每个词出现在多少个文档中\n        this.documents.forEach(doc => {\n            const uniqueTerms = new Set(doc.keywords);\n            uniqueTerms.forEach(term => {\n                termDocCount.set(term, (termDocCount.get(term) || 0) + 1);\n            });\n        });\n\n        // 计算 IDF: log((N - df + 0.5) / (df + 0.5) + 1)\n        termDocCount.forEach((df, term) => {\n            this.idf.set(term, Math.log((N - df + 0.5) / (df + 0.5) + 1));\n        });\n    }\n\n    /**\n     * 计算 BM25 分数\n     * @param {Array} queryTerms - 查询词列表\n     * @param {Object} doc - 文档对象\n     * @returns {number} BM25 分数\n     */\n    _calculateBM25(queryTerms, doc) {\n        let score = 0;\n        const docLength = doc.keywords.length;\n\n        queryTerms.forEach(term => {\n            // 计算词频 (TF)\n            const tf = doc.keywords.filter(k => k === term).length;\n\n            if (tf === 0) return;\n\n            // 获取 IDF\n            const idf = this.idf.get(term) || 0;\n\n            // BM25 公式\n            const numerator = tf * (this.k1 + 1);\n            const denominator = tf + this.k1 * (1 - this.b + this.b * (docLength / this.avgDocLength));\n\n            score += idf * (numerator / denominator);\n        });\n\n        // 应用权重\n        return score * doc.weight;\n    }\n\n    /**\n     * 搜索匹配的 emoticon\n     * @param {string} text - 要搜索的文本\n     * @param {number} topK - 返回前 K 个结果\n     * @param {number} threshold - 最低分数阈值\n     * @returns {Array} 匹配结果数组\n     */\n    search(text, topK = 5, threshold = 0) {\n        if (!text || this.documents.length === 0) {\n            return [];\n        }\n\n        // 提取查询词（简单分词，可以根据需求优化）\n        const queryTerms = this._tokenize(text);\n\n        if (queryTerms.length === 0) {\n            return [];\n        }\n\n        // 转换为 Set 以提高查找效率 (O(1) vs O(n))\n        const queryTermsSet = new Set(queryTerms);\n\n        // 计算每个文档的分数\n        const results = this.documents.map(doc => ({\n            emoticon: doc.emoticon,\n            score: this._calculateBM25(queryTerms, doc),\n            matchedKeywords: doc.keywords.filter(k => queryTermsSet.has(k)),\n            category: doc.category\n        }));\n\n        // 过滤、排序并返回 top K\n        return results\n            .filter(r => r.score > threshold && r.matchedKeywords.length > 0)\n            .sort((a, b) => b.score - a.score)\n            .slice(0, topK);\n    }\n\n    /**\n     * 简单分词函数\n     * @param {string} text - 输入文本\n     * @returns {Array} 词列表\n     */\n    _tokenize(text) {\n        // 移除空格和标点\n        const cleaned = text.replace(/[^\\u4e00-\\u9fa5a-zA-Z0-9]/g, ' ');\n\n        // 简单按空格分词（对于中文需要更复杂的分词，但这里保持简单）\n        // 也包含所有可能的子串（对于短文本）\n        const words = cleaned.split(/\\s+/).filter(w => w.length > 0);\n\n        // 对于中文，额外提取所有连续字符组合\n        const chineseChars = text.match(/[\\u4e00-\\u9fa5]+/g) || [];\n        chineseChars.forEach(chunk => {\n            // 提取所有可能的词组合（2-4字）\n            for (let len = 2; len <= Math.min(4, chunk.length); len++) {\n                for (let i = 0; i <= chunk.length - len; i++) {\n                    words.push(chunk.slice(i, i + len));\n                }\n            }\n            // 也加入单字\n            for (let char of chunk) {\n                words.push(char);\n            }\n        });\n\n        return [...new Set(words)]; // 去重\n    }\n\n    /**\n     * 精确匹配关键词\n     * @param {string} text - 输入文本\n     * @returns {Array} 精确匹配的结果\n     */\n    exactMatch(text) {\n        const results = [];\n\n        this.documents.forEach(doc => {\n            const matchedKeywords = doc.keywords.filter(keyword =>\n                text.includes(keyword)\n            );\n\n            if (matchedKeywords.length > 0) {\n                results.push({\n                    emoticon: doc.emoticon,\n                    matchedKeywords: matchedKeywords,\n                    score: matchedKeywords.length * doc.weight,\n                    category: doc.category\n                });\n            }\n        });\n\n        return results.sort((a, b) => b.score - a.score);\n    }\n}\n\n// 导出（支持 CommonJS 和 ES6）\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = SearchEngine;\n}\nif (typeof window !== 'undefined') {\n    window.SearchEngine = SearchEngine;\n}\n","/**\n * EmoticonDataManager.js\n * 颜文字数据管理类 - 完整 CRUD\n */\n\nclass EmoticonDataManager {\n    constructor() {\n        this.emoticons = [];\n    }\n\n    // ========== 数据加载 ==========\n\n    /**\n     * 从 JSON 字符串加载数据\n     * @param {string} jsonString - JSON 字符串\n     * @returns {EmoticonDataManager} 链式调用\n     */\n    loadFromJSON(jsonString) {\n        try {\n            const data = JSON.parse(jsonString);\n            return this.loadFromArray(data);\n        } catch (error) {\n            console.error('Failed to parse JSON:', error);\n            throw new Error('Invalid JSON format');\n        }\n    }\n\n    /**\n     * 从对象数组加载数据\n     * @param {Array} data - 颜文字数据数组\n     * @returns {EmoticonDataManager} 链式调用\n     */\n    loadFromArray(data) {\n        if (!Array.isArray(data)) {\n            throw new Error('Data must be an array');\n        }\n\n        this.emoticons = [];\n        data.forEach((item, index) => {\n            if (this._validateItem(item, index)) {\n                this.emoticons.push(this._normalizeItem(item));\n            }\n        });\n\n        console.log(`Loaded ${this.emoticons.length} emoticons`);\n        return this;\n    }\n\n    /**\n     * 验证数据项\n     * @private\n     */\n    _validateItem(item, index) {\n        if (!item.emoticon || typeof item.emoticon !== 'string') {\n            console.warn(`Item ${index}: Missing or invalid 'emoticon' field, skipping`);\n            return false;\n        }\n\n        if (!item.keywords || !Array.isArray(item.keywords) || item.keywords.length === 0) {\n            console.warn(`Item ${index}: Missing or invalid 'keywords' field, skipping`);\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * 规范化数据项\n     * @private\n     */\n    _normalizeItem(item) {\n        return {\n            emoticon: item.emoticon,\n            keywords: item.keywords.map(k => String(k).trim()).filter(k => k.length > 0),\n            weight: typeof item.weight === 'number' ? item.weight : 1.0,\n            category: item.category || ''\n        };\n    }\n\n    /**\n     * 深拷贝单个颜文字对象\n     * @private\n     * @param {Object} item - 颜文字对象\n     * @returns {Object} 深拷贝的对象\n     */\n    _deepCopy(item) {\n        return {\n            emoticon: item.emoticon,\n            keywords: [...item.keywords],\n            weight: item.weight,\n            category: item.category\n        };\n    }\n\n    // ========== 读取操作 ==========\n\n    /**\n     * 获取所有颜文字（深拷贝）\n     * @returns {Array} 颜文字数组的深拷贝\n     */\n    getAllEmoticons() {\n        return this.emoticons.map(item => this._deepCopy(item));\n    }\n\n    /**\n     * 通过颜文字文本查找（深拷贝）\n     * @param {string} emoticon - 颜文字文本\n     * @returns {Object|null} 颜文字对象的深拷贝，未找到返回 null\n     */\n    getEmoticonByText(emoticon) {\n        const found = this.emoticons.find(item => item.emoticon === emoticon);\n        return found ? this._deepCopy(found) : null;\n    }\n\n    /**\n     * 获取所有关键词列表（去重）\n     * @returns {Array} 关键词数组\n     */\n    getAllKeywords() {\n        const keywords = new Set();\n        this.emoticons.forEach(item => {\n            item.keywords.forEach(keyword => keywords.add(keyword));\n        });\n        return Array.from(keywords).sort();\n    }\n\n    /**\n     * 获取特定颜文字的关键词\n     * @param {string} emoticon - 颜文字文本\n     * @returns {Array} 关键词数组，未找到返回空数组\n     */\n    getKeywordsByEmoticon(emoticon) {\n        const item = this.emoticons.find(e => e.emoticon === emoticon);\n        return item ? [...item.keywords] : [];\n    }\n\n    /**\n     * 按分类筛选（深拷贝）\n     * @param {string|Array} category - 分类名称或分类数组\n     * @returns {Array} 筛选后的颜文字数组的深拷贝\n     */\n    filterByCategory(category) {\n        const categories = Array.isArray(category) ? category : [category];\n        return this.emoticons\n            .filter(item => categories.includes(item.category))\n            .map(item => this._deepCopy(item));\n    }\n\n    /**\n     * 获取所有分类列表（去重）\n     * @returns {Array} 分类数组\n     */\n    getAllCategories() {\n        const categories = new Set();\n        this.emoticons.forEach(item => {\n            if (item.category) {\n                categories.add(item.category);\n            }\n        });\n        return Array.from(categories).sort();\n    }\n\n    /**\n     * 搜索包含特定关键词的颜文字（深拷贝）\n     * @param {string} keyword - 关键词\n     * @returns {Array} 包含该关键词的颜文字数组的深拷贝\n     */\n    findByKeyword(keyword) {\n        return this.emoticons\n            .filter(item => item.keywords.includes(keyword))\n            .map(item => this._deepCopy(item));\n    }\n\n    /**\n     * 获取数据统计信息\n     * @returns {Object} 统计数据\n     */\n    getStats() {\n        return {\n            totalEmoticons: this.emoticons.length,\n            totalKeywords: this.getAllKeywords().length,\n            totalCategories: this.getAllCategories().length,\n            averageKeywordsPerEmoticon: this.emoticons.length > 0\n                ? this.emoticons.reduce((sum, e) => sum + e.keywords.length, 0) / this.emoticons.length\n                : 0\n        };\n    }\n\n    // ========== 修改操作 ==========\n\n    /**\n     * 添加关键词\n     * @param {string} emoticon - 颜文字文本\n     * @param {string} keyword - 要添加的关键词\n     * @returns {boolean} 是否成功\n     */\n    addKeyword(emoticon, keyword) {\n        const item = this.emoticons.find(e => e.emoticon === emoticon);\n        if (!item) {\n            console.warn(`Emoticon \"${emoticon}\" not found`);\n            return false;\n        }\n\n        const trimmedKeyword = String(keyword).trim();\n        if (!trimmedKeyword) {\n            console.warn('Keyword cannot be empty');\n            return false;\n        }\n\n        if (item.keywords.includes(trimmedKeyword)) {\n            console.warn(`Keyword \"${trimmedKeyword}\" already exists`);\n            return false;\n        }\n\n        item.keywords.push(trimmedKeyword);\n        return true;\n    }\n\n    /**\n     * 删除关键词\n     * @param {string} emoticon - 颜文字文本\n     * @param {string} keyword - 要删除的关键词\n     * @returns {boolean} 是否成功\n     */\n    removeKeyword(emoticon, keyword) {\n        const item = this.emoticons.find(e => e.emoticon === emoticon);\n        if (!item) {\n            console.warn(`Emoticon \"${emoticon}\" not found`);\n            return false;\n        }\n\n        const index = item.keywords.indexOf(keyword);\n        if (index === -1) {\n            console.warn(`Keyword \"${keyword}\" not found`);\n            return false;\n        }\n\n        if (item.keywords.length <= 1) {\n            console.warn('Cannot remove the last keyword');\n            return false;\n        }\n\n        item.keywords.splice(index, 1);\n        return true;\n    }\n\n    /**\n     * 批量更新关键词\n     * @param {string} emoticon - 颜文字文本\n     * @param {Array} keywords - 新的关键词数组\n     * @returns {boolean} 是否成功\n     */\n    updateKeywords(emoticon, keywords) {\n        const item = this.emoticons.find(e => e.emoticon === emoticon);\n        if (!item) {\n            console.warn(`Emoticon \"${emoticon}\" not found`);\n            return false;\n        }\n\n        if (!Array.isArray(keywords) || keywords.length === 0) {\n            console.warn('Keywords must be a non-empty array');\n            return false;\n        }\n\n        const validKeywords = keywords\n            .map(k => String(k).trim())\n            .filter(k => k.length > 0);\n\n        if (validKeywords.length === 0) {\n            console.warn('No valid keywords provided');\n            return false;\n        }\n\n        item.keywords = validKeywords;\n        return true;\n    }\n\n    /**\n     * 设置分类\n     * @param {string} emoticon - 颜文字文本\n     * @param {string} category - 分类名称\n     * @returns {boolean} 是否成功\n     */\n    setCategory(emoticon, category) {\n        const item = this.emoticons.find(e => e.emoticon === emoticon);\n        if (!item) {\n            console.warn(`Emoticon \"${emoticon}\" not found`);\n            return false;\n        }\n\n        item.category = category || '';\n        return true;\n    }\n\n    /**\n     * 设置权重\n     * @param {string} emoticon - 颜文字文本\n     * @param {number} weight - 权重值\n     * @returns {boolean} 是否成功\n     */\n    setWeight(emoticon, weight) {\n        const item = this.emoticons.find(e => e.emoticon === emoticon);\n        if (!item) {\n            console.warn(`Emoticon \"${emoticon}\" not found`);\n            return false;\n        }\n\n        if (typeof weight !== 'number' || weight <= 0) {\n            console.warn('Weight must be a positive number');\n            return false;\n        }\n\n        item.weight = weight;\n        return true;\n    }\n\n    // ========== 颜文字管理 ==========\n\n    /**\n     * 添加新颜文字\n     * @param {Object} data - 颜文字数据 { emoticon, keywords, weight?, category? }\n     * @returns {boolean} 是否成功\n     */\n    addEmoticon(data) {\n        if (!this._validateItem(data, 'new')) {\n            return false;\n        }\n\n        // 检查是否已存在\n        if (this.emoticons.find(e => e.emoticon === data.emoticon)) {\n            console.warn(`Emoticon \"${data.emoticon}\" already exists`);\n            return false;\n        }\n\n        this.emoticons.push(this._normalizeItem(data));\n        return true;\n    }\n\n    /**\n     * 删除颜文字\n     * @param {string} emoticon - 颜文字文本\n     * @returns {boolean} 是否成功\n     */\n    removeEmoticon(emoticon) {\n        const index = this.emoticons.findIndex(e => e.emoticon === emoticon);\n        if (index === -1) {\n            console.warn(`Emoticon \"${emoticon}\" not found`);\n            return false;\n        }\n\n        this.emoticons.splice(index, 1);\n        return true;\n    }\n\n    /**\n     * 更新颜文字完整数据\n     * @param {string} emoticon - 原颜文字文本\n     * @param {Object} newData - 新数据\n     * @returns {boolean} 是否成功\n     */\n    updateEmoticon(emoticon, newData) {\n        const index = this.emoticons.findIndex(e => e.emoticon === emoticon);\n        if (index === -1) {\n            console.warn(`Emoticon \"${emoticon}\" not found`);\n            return false;\n        }\n\n        if (!this._validateItem(newData, 'update')) {\n            return false;\n        }\n\n        // 如果更改了 emoticon 文本，检查新文本是否已存在\n        if (newData.emoticon !== emoticon) {\n            if (this.emoticons.find(e => e.emoticon === newData.emoticon)) {\n                console.warn(`Emoticon \"${newData.emoticon}\" already exists`);\n                return false;\n            }\n        }\n\n        this.emoticons[index] = this._normalizeItem(newData);\n        return true;\n    }\n\n    // ========== 数据导出 ==========\n\n    /**\n     * 导出为 JSON 字符串\n     * @param {boolean} pretty - 是否格式化输出\n     * @returns {string} JSON 字符串\n     */\n    exportToJSON(pretty = true) {\n        return JSON.stringify(this.emoticons, null, pretty ? 2 : 0);\n    }\n\n    /**\n     * 导出为对象数组\n     * @returns {Array} 颜文字数组的深拷贝\n     */\n    exportToArray() {\n        return this.emoticons.map(item => ({ ...item, keywords: [...item.keywords] }));\n    }\n\n    // ========== 批量操作 ==========\n\n    /**\n     * 批量修改分类\n     * @param {Array} emoticons - 颜文字文本数组\n     * @param {string} category - 分类名称\n     * @returns {number} 成功修改的数量\n     */\n    batchSetCategory(emoticons, category) {\n        let count = 0;\n        emoticons.forEach(emoticon => {\n            if (this.setCategory(emoticon, category)) {\n                count++;\n            }\n        });\n        return count;\n    }\n\n    /**\n     * 批量删除颜文字\n     * @param {Array} emoticons - 颜文字文本数组\n     * @returns {number} 成功删除的数量\n     */\n    batchRemove(emoticons) {\n        let count = 0;\n        emoticons.forEach(emoticon => {\n            if (this.removeEmoticon(emoticon)) {\n                count++;\n            }\n        });\n        return count;\n    }\n\n    /**\n     * 清空所有数据\n     */\n    clear() {\n        this.emoticons = [];\n    }\n}\n\n// 导出（支持 CommonJS 和 ES6）\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = EmoticonDataManager;\n}\nif (typeof window !== 'undefined') {\n    window.EmoticonDataManager = EmoticonDataManager;\n}\n","/**\n * IndexedDBStorage.js\n * 前端 IndexedDB 存储管理\n * 用于在浏览器中持久化颜文字数据\n */\n\nconst DB_NAME = 'EmoticonReplacerDB';\nconst DB_VERSION = 1;\nconst STORE_NAME = 'emoticons';\nconst DATA_KEY = 'emoticon_data';\n\n// 调试开关（默认关闭）\nlet DEBUG_MODE = false;\n\n/**\n * 设置调试模式\n * @param {boolean} enabled - 是否启用调试模式\n */\nfunction setDebugMode(enabled) {\n    DEBUG_MODE = enabled;\n}\n\n/**\n * 调试日志（仅在调试模式开启时输出）\n */\nfunction debugLog(message, ...args) {\n    if (DEBUG_MODE) {\n        console.log(`[EmoticonReplacer] ${message}`, ...args);\n    }\n}\n\nfunction debugWarn(message, ...args) {\n    if (DEBUG_MODE) {\n        console.warn(`[EmoticonReplacer] ${message}`, ...args);\n    }\n}\n\nfunction debugError(message, ...args) {\n    // 错误总是输出，但在非调试模式下简化\n    if (DEBUG_MODE) {\n        console.error(`[EmoticonReplacer] ${message}`, ...args);\n    } else {\n        console.error(`[EmoticonReplacer] ${message}`);\n    }\n}\n\n/**\n * 打开 IndexedDB 连接\n * @returns {Promise<IDBDatabase>}\n */\nfunction openDatabase() {\n    return new Promise((resolve, reject) => {\n        if (typeof indexedDB === 'undefined') {\n            reject(new Error('IndexedDB is not supported in this environment'));\n            return;\n        }\n\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n        request.onerror = () => {\n            reject(new Error('Failed to open IndexedDB'));\n        };\n\n        request.onsuccess = () => {\n            resolve(request.result);\n        };\n\n        request.onupgradeneeded = (event) => {\n            const db = event.target.result;\n\n            // 创建对象存储\n            if (!db.objectStoreNames.contains(STORE_NAME)) {\n                db.createObjectStore(STORE_NAME);\n            }\n        };\n    });\n}\n\n/**\n * 从 IndexedDB 读取颜文字数据\n * @returns {Promise<Array|null>} 颜文字数组，不存在返回 null\n */\nasync function getEmoticons() {\n    try {\n        const db = await openDatabase();\n\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readonly');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.get(DATA_KEY);\n\n            transaction.oncomplete = () => {\n                db.close();\n            };\n\n            transaction.onerror = () => {\n                db.close();\n                reject(new Error('Transaction failed'));\n            };\n\n            request.onsuccess = () => {\n                resolve(request.result || null);\n            };\n\n            request.onerror = () => {\n                reject(new Error('Failed to read from IndexedDB'));\n            };\n        });\n    } catch (error) {\n        debugError('Error reading from IndexedDB:', error);\n        return null;\n    }\n}\n\n/**\n * 保存颜文字数据到 IndexedDB\n * @param {Array} data - 颜文字数组\n * @returns {Promise<boolean>} 是否成功\n */\nasync function saveEmoticons(data) {\n    if (!Array.isArray(data)) {\n        debugError('Data must be an array');\n        return false;\n    }\n\n    try {\n        const db = await openDatabase();\n\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.put(data, DATA_KEY);\n\n            transaction.oncomplete = () => {\n                db.close();\n                debugLog(`Saved ${data.length} emoticons to IndexedDB`);\n                resolve(true);\n            };\n\n            transaction.onerror = () => {\n                db.close();\n                reject(new Error('Transaction failed'));\n            };\n\n            request.onerror = () => {\n                reject(new Error('Failed to save to IndexedDB'));\n            };\n        });\n    } catch (error) {\n        debugError('Error saving to IndexedDB:', error);\n        return false;\n    }\n}\n\n/**\n * 清空 IndexedDB 中的颜文字数据\n * @returns {Promise<boolean>} 是否成功\n */\nasync function clearEmoticons() {\n    try {\n        const db = await openDatabase();\n\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.delete(DATA_KEY);\n\n            transaction.oncomplete = () => {\n                db.close();\n                debugLog('Cleared emoticons from IndexedDB');\n                resolve(true);\n            };\n\n            transaction.onerror = () => {\n                db.close();\n                reject(new Error('Transaction failed'));\n            };\n\n            request.onerror = () => {\n                reject(new Error('Failed to clear IndexedDB'));\n            };\n        });\n    } catch (error) {\n        debugError('Error clearing IndexedDB:', error);\n        return false;\n    }\n}\n\n/**\n * 从远程 URL 加载默认数据\n * @param {string} url - 数据 URL\n * @returns {Promise<Array|null>} 颜文字数组，失败返回 null\n */\nasync function loadFromRemote(url) {\n    try {\n        const response = await fetch(url);\n\n        if (!response.ok) {\n            debugWarn(`Failed to fetch from ${url}: ${response.status}`);\n            return null;\n        }\n\n        const data = await response.json();\n\n        if (!Array.isArray(data)) {\n            debugWarn('Remote data is not an array');\n            return null;\n        }\n\n        return data;\n    } catch (error) {\n        debugWarn('Failed to load from remote:', error);\n        return null;\n    }\n}\n\n/**\n * 初始化颜文字存储\n * - 如果 IndexedDB 中已有数据，直接返回\n * - 如果没有，尝试从远程 URL 加载并保存\n * - 远程加载失败则返回空数组\n *\n * @param {Object} options - 配置选项\n * @param {string} options.defaultURL - 默认数据的远程 URL\n * @param {boolean} options.forceReload - 是否强制重新加载（忽略缓存）\n * @returns {Promise<Array>} 颜文字数组\n */\nasync function initEmoticonStorage(options = {}) {\n    const {\n        defaultURL = null,\n        forceReload = false\n    } = options;\n\n    try {\n        // 检查 IndexedDB 是否已有数据\n        if (!forceReload) {\n            const existingData = await getEmoticons();\n            if (existingData && existingData.length > 0) {\n                debugLog(`Loaded ${existingData.length} emoticons from IndexedDB cache`);\n                return existingData;\n            }\n        }\n\n        // 如果没有数据且提供了远程 URL，尝试加载\n        if (defaultURL) {\n            debugLog(`Loading default emoticons from ${defaultURL}...`);\n            const remoteData = await loadFromRemote(defaultURL);\n\n            if (remoteData && remoteData.length > 0) {\n                // 保存到 IndexedDB\n                await saveEmoticons(remoteData);\n                debugLog(`Initialized with ${remoteData.length} emoticons from remote`);\n                return remoteData;\n            } else {\n                debugWarn('Failed to load from remote, returning empty array');\n            }\n        }\n\n        // 返回空数组\n        return [];\n    } catch (error) {\n        debugError('Error initializing emoticon storage:', error);\n        return [];\n    }\n}\n\n/**\n * 获取存储统计信息\n * @returns {Promise<Object>} 统计信息\n */\nasync function getStorageStats() {\n    try {\n        const data = await getEmoticons();\n\n        return {\n            hasData: data !== null,\n            count: data ? data.length : 0,\n            sizeKB: data ? (JSON.stringify(data).length / 1024).toFixed(2) : '0.00'\n        };\n    } catch (error) {\n        return {\n            hasData: false,\n            count: 0,\n            sizeKB: 0,\n            error: error.message\n        };\n    }\n}\n\n// 导出（支持 CommonJS 和 ES6）\nconst IndexedDBStorage = {\n    initEmoticonStorage,\n    getEmoticons,\n    saveEmoticons,\n    clearEmoticons,\n    getStorageStats,\n    setDebugMode\n};\n\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = IndexedDBStorage;\n}\n\nif (typeof window !== 'undefined') {\n    window.IndexedDBStorage = IndexedDBStorage;\n}\n","/**\n * Emoticon Replacer - Unified API Entry Point\n *\n * 提供多种导入和使用方式：\n * 1. 类导入：const { EmoticonReplacer, SearchEngine, EmoticonDataManager } = require('emoticon-replacer');\n * 2. 工厂函数：const { createReplacer, createManager } = require('emoticon-replacer');\n * 3. 快捷 API：const { quickReplace } = require('emoticon-replacer');\n */\n\n// 导入核心类\nconst EmoticonReplacer = require('./src/core/EmoticonReplacer');\nconst SearchEngine = require('./src/core/SearchEngine');\nconst EmoticonDataManager = require('./src/core/EmoticonDataManager');\n\n// 导入存储模块\nconst IndexedDBStorage = require('./src/storage/IndexedDBStorage');\n\n// ========== 工厂函数 ==========\n\n/**\n * 创建一个完整配置的 EmoticonReplacer 实例\n * @param {Object} options - 配置选项\n * @param {Array} options.emoticons - 颜文字数据数组\n * @param {string} options.jsonData - JSON 格式的颜文字数据\n * @param {Object} options.searchConfig - SearchEngine 配置 { k1, b }\n * @param {Object} options.replaceConfig - EmoticonReplacer 配置\n * @returns {EmoticonReplacer} 配置好的 EmoticonReplacer 实例\n */\nfunction createReplacer(options = {}) {\n    const {\n        emoticons = [],\n        jsonData = null,\n        searchConfig = {},\n        replaceConfig = {}\n    } = options;\n\n    // 创建搜索引擎\n    const searchEngine = new SearchEngine(searchConfig);\n\n    // 创建替换器\n    const replacer = new EmoticonReplacer(searchEngine);\n\n    // 应用配置\n    if (replaceConfig) {\n        replacer.setConfig(replaceConfig);\n    }\n\n    // 加载数据\n    if (jsonData) {\n        const manager = new EmoticonDataManager();\n        manager.loadFromJSON(jsonData);\n        replacer.loadEmoticons(manager.getAllEmoticons());\n    } else if (emoticons.length > 0) {\n        replacer.loadEmoticons(emoticons);\n    }\n\n    return replacer;\n}\n\n/**\n * 创建 EmoticonDataManager 实例并加载数据\n * @param {Array|string} data - 颜文字数据数组或 JSON 字符串\n * @returns {EmoticonDataManager} 加载好数据的 EmoticonDataManager 实例\n */\nfunction createManager(data = null) {\n    const manager = new EmoticonDataManager();\n\n    if (data) {\n        if (typeof data === 'string') {\n            manager.loadFromJSON(data);\n        } else if (Array.isArray(data)) {\n            manager.loadFromArray(data);\n        }\n    }\n\n    return manager;\n}\n\n/**\n * 创建 SearchEngine 实例\n * @param {Object} config - BM25 配置 { k1, b }\n * @returns {SearchEngine} SearchEngine 实例\n */\nfunction createSearchEngine(config = {}) {\n    return new SearchEngine(config);\n}\n\n// ========== 快捷 API ==========\n\n/**\n * 快速替换文本（一站式 API）\n * @param {string} text - 要处理的文本\n * @param {Array|string} emoticons - 颜文字数据（数组或 JSON 字符串）\n * @param {Object} options - 替换选项\n * @returns {Object} 替换结果\n */\nfunction quickReplace(text, emoticons, options = {}) {\n    const replacer = createReplacer({\n        emoticons: Array.isArray(emoticons) ? emoticons : [],\n        jsonData: typeof emoticons === 'string' ? emoticons : null,\n        searchConfig: options.searchConfig,\n        replaceConfig: options.replaceConfig\n    });\n\n    return replacer.replaceText(text, options);\n}\n\n/**\n * 快速查询关键词对应的颜文字\n * @param {string} keywords - 关键词\n * @param {Array|string} emoticons - 颜文字数据\n * @param {number} topK - 返回前 K 个结果\n * @returns {Array} 匹配结果\n */\nfunction quickQuery(keywords, emoticons, topK = 5) {\n    const replacer = createReplacer({\n        emoticons: Array.isArray(emoticons) ? emoticons : [],\n        jsonData: typeof emoticons === 'string' ? emoticons : null\n    });\n\n    return replacer.query(keywords, topK);\n}\n\n/**\n * 从文件路径加载颜文字数据（仅 Node.js 环境）\n * @param {string} filePath - 文件路径\n * @returns {Promise<Array>} 颜文字数据数组\n */\nasync function loadFromFile(filePath) {\n    // 检查是否在 Node.js 环境\n    if (typeof require === 'undefined' || typeof process === 'undefined') {\n        throw new Error('loadFromFile is only available in Node.js environment');\n    }\n\n    const fs = require('fs').promises;\n    const fileContent = await fs.readFile(filePath, 'utf8');\n    const manager = new EmoticonDataManager();\n    manager.loadFromJSON(fileContent);\n    return manager.getAllEmoticons();\n}\n\n/**\n * 从 URL 加载颜文字数据（浏览器环境）\n * @param {string} url - 数据 URL\n * @returns {Promise<Array>} 颜文字数据数组\n */\nasync function loadFromURL(url) {\n    const response = await fetch(url);\n\n    if (!response.ok) {\n        throw new Error(`Failed to load from URL: ${response.status} ${response.statusText}`);\n    }\n\n    const jsonText = await response.text();\n    const manager = new EmoticonDataManager();\n    manager.loadFromJSON(jsonText);\n    return manager.getAllEmoticons();\n}\n\n// ========== 工具函数 ==========\n\n/**\n * 验证颜文字数据格式\n * @param {Array} data - 颜文字数据数组\n * @returns {Object} 验证结果 { valid, errors }\n */\nfunction validateData(data) {\n    const errors = [];\n\n    if (!Array.isArray(data)) {\n        return { valid: false, errors: ['Data must be an array'] };\n    }\n\n    data.forEach((item, index) => {\n        if (typeof item !== 'object' || item === null) {\n            errors.push(`Item ${index}: Must be an object.`);\n            return;\n        }\n\n        if (!item.emoticon || typeof item.emoticon !== 'string') {\n            errors.push(`Item ${index}: Missing or invalid 'emoticon' field`);\n        }\n\n        if (!item.keywords || !Array.isArray(item.keywords) || item.keywords.length === 0) {\n            errors.push(`Item ${index}: Missing or invalid 'keywords' field`);\n        }\n\n        if (item.weight !== undefined && (typeof item.weight !== 'number' || item.weight <= 0)) {\n            errors.push(`Item ${index}: Invalid 'weight' field (must be positive number)`);\n        }\n    });\n\n    return {\n        valid: errors.length === 0,\n        errors\n    };\n}\n\n/**\n * 批量处理文本数组\n * @param {Array<string>} texts - 文本数组\n * @param {Array|string} emoticons - 颜文字数据\n * @param {Object} options - 替换选项\n * @returns {Array} 处理结果数组\n */\nfunction batchReplace(texts, emoticons, options = {}) {\n    const replacer = createReplacer({\n        emoticons: Array.isArray(emoticons) ? emoticons : [],\n        jsonData: typeof emoticons === 'string' ? emoticons : null,\n        searchConfig: options.searchConfig,\n        replaceConfig: options.replaceConfig\n    });\n\n    return replacer.replaceMultiple(texts, options);\n}\n\n// ========== 常量 ==========\n\nconst VERSION = '1.0.1';\n\nconst DEFAULT_CONFIG = {\n    search: {\n        k1: 1.5,\n        b: 0.75\n    },\n    replace: {\n        markerPattern: /\\[emoticon:([^\\]]+)\\]/gi,\n        keywordSeparator: ',',\n        replaceStrategy: 'best'\n    }\n};\n\nconst REPLACE_STRATEGIES = {\n    FIRST: 'first',    // 使用第一个匹配结果\n    BEST: 'best',      // 使用最佳匹配结果（默认）\n    ALL: 'all'         // 返回所有匹配结果\n};\n\n// ========== 导出 ==========\n\n// CommonJS 导出\nmodule.exports = {\n    // 核心类\n    EmoticonReplacer,\n    SearchEngine,\n    EmoticonDataManager,\n\n    // 工厂函数\n    createReplacer,\n    createManager,\n    createSearchEngine,\n\n    // 快捷 API\n    quickReplace,\n    quickQuery,\n\n    // 数据加载\n    loadFromFile,\n    loadFromURL,\n\n    // 工具函数\n    validateData,\n    batchReplace,\n\n    // 存储 API (IndexedDB)\n    initEmoticonStorage: IndexedDBStorage.initEmoticonStorage,\n    getEmoticons: IndexedDBStorage.getEmoticons,\n    saveEmoticons: IndexedDBStorage.saveEmoticons,\n    clearEmoticons: IndexedDBStorage.clearEmoticons,\n    getStorageStats: IndexedDBStorage.getStorageStats,\n    setDebugMode: IndexedDBStorage.setDebugMode,\n\n    // 常量\n    VERSION,\n    DEFAULT_CONFIG,\n    REPLACE_STRATEGIES\n};\n"],"names":["EmoticonReplacer","constructor","searchEngine","this","config","markerPattern","keywordSeparator","replaceStrategy","setConfig","Object","assign","loadEmoticons","emoticons","buildIndex","replaceText","text","options","strategy","threshold","keepOriginalOnNotFound","markNotFound","result","replacements","matchIndex","replace","match","keywordsStr","offset","keywords","split","map","k","trim","filter","length","searchText","join","matches","search","replacement","selectedEmoticon","emoticon","m","push","index","original","selected","notFound","originalText","hasReplacements","successCount","r","failureCount","replaceMultiple","texts","preview","markers","regex","RegExp","exec","marker","bestMatch","query","topK","exactQuery","exactMatch","getStats","totalEmoticons","documents","avgDocLength","module","exports","window","SearchEngine","k1","b","idf","Map","item","weight","category","totalLength","reduce","sum","doc","_calculateIDF","termDocCount","N","forEach","Set","term","set","get","df","Math","log","_calculateBM25","queryTerms","score","docLength","tf","_tokenize","queryTermsSet","matchedKeywords","has","sort","a","slice","words","w","chunk","len","min","i","char","results","keyword","includes","EmoticonDataManager","loadFromJSON","jsonString","data","JSON","parse","loadFromArray","error","console","Error","Array","isArray","_validateItem","_normalizeItem","warn","String","_deepCopy","getAllEmoticons","getEmoticonByText","found","find","getAllKeywords","add","from","getKeywordsByEmoticon","e","filterByCategory","categories","getAllCategories","findByKeyword","totalKeywords","totalCategories","averageKeywordsPerEmoticon","addKeyword","trimmedKeyword","removeKeyword","indexOf","splice","updateKeywords","validKeywords","setCategory","setWeight","addEmoticon","removeEmoticon","findIndex","updateEmoticon","newData","exportToJSON","pretty","stringify","exportToArray","batchSetCategory","count","batchRemove","clear","STORE_NAME","DATA_KEY","DEBUG_MODE","debugLog","message","args","debugWarn","debugError","openDatabase","Promise","resolve","reject","indexedDB","request","open","onerror","onsuccess","onupgradeneeded","event","db","target","objectStoreNames","contains","createObjectStore","async","getEmoticons","transaction","objectStore","oncomplete","close","saveEmoticons","put","IndexedDBStorage","initEmoticonStorage","defaultURL","forceReload","existingData","remoteData","url","response","fetch","ok","status","json","loadFromRemote","clearEmoticons","delete","getStorageStats","hasData","sizeKB","toFixed","setDebugMode","enabled","require$$0","require$$1","require$$2","createReplacer","jsonData","searchConfig","replaceConfig","replacer","manager","EmoticonReplacer_1","createManager","createSearchEngine","quickReplace","quickQuery","loadFromFile","filePath","require","process","fs","require$$4","promises","fileContent","readFile","loadFromURL","statusText","jsonText","validateData","errors","undefined","valid","batchReplace","require$$3","VERSION","DEFAULT_CONFIG","REPLACE_STRATEGIES","FIRST","BEST","ALL"],"mappings":"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"}