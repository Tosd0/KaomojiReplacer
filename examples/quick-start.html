<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaomoji Replacer - UMD å¿«é€Ÿå¼€å§‹</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
        .section {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }
        button:hover { background: #45a049; }
        .output {
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 10px;
            margin: 10px 0;
        }
        .code-comment { color: #6a9955; }
    </style>
</head>
<body>
    <h1>ğŸš€ Kaomoji Replacer - UMD å¿«é€Ÿå¼€å§‹</h1>
    <p>æœ€å°åŒ–å®ç°ç¤ºä¾‹ï¼šå±•ç¤ºå¦‚ä½•åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ UMD + CDN + IndexedDB</p>

    <!-- Step 1: å¼•å…¥ -->
    <div class="section">
        <h2>1ï¸âƒ£ å¼•å…¥ UMD æ–‡ä»¶</h2>
        <pre><code>&lt;!-- ä» CDN å¼•å…¥ï¼ˆæ¨èï¼‰ --&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/kaomoji-replacer/dist/kaomoji-replacer.umd.min.js"&gt;&lt;/script&gt;

&lt;!-- æˆ–ä»æœ¬åœ°å¼•å…¥ --&gt;
&lt;script src="../dist/kaomoji-replacer.umd.min.js"&gt;&lt;/script&gt;</code></pre>
    </div>

    <!-- Step 2: åˆå§‹åŒ– -->
    <div class="section">
        <h2>2ï¸âƒ£ åˆå§‹åŒ–å¹¶åŠ è½½æ•°æ®</h2>
        <pre><code><span class="code-comment">// é¦–æ¬¡ä» CDN åŠ è½½ï¼Œä¹‹åä» IndexedDB ç¼“å­˜è¯»å–</span>
const kaomojis = await KaomojiReplacer.initKaomojiStorage({
    defaultURL: 'https://cdn.jsdelivr.net/npm/kaomoji-replacer/data/kaomojis.template.json'
});

<span class="code-comment">// åˆ›å»ºæ›¿æ¢å™¨å®ä¾‹</span>
const replacer = KaomojiReplacer.createReplacer({ kaomojis });</code></pre>
        <button onclick="init()">è¿è¡Œåˆå§‹åŒ–</button>
        <div class="output" id="init-output">ç‚¹å‡»æŒ‰é’®è¿è¡Œ...</div>
    </div>

    <!-- Step 3: æ–‡æœ¬æ›¿æ¢ -->
    <div class="section">
        <h2>3ï¸âƒ£ æ–‡æœ¬æ›¿æ¢ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰</h2>
        <pre><code><span class="code-comment">// å¾…å¤„ç†æ–‡æœ¬</span>
const input = 'ä»Šå¤©çœŸæ˜¯[kaomoji:æ— è¯­,é»‘è„¸]';

<span class="code-comment">// è°ƒç”¨å¤„ç†</span>
const result = replacer.replaceText(input);

<span class="code-comment">// å¤„ç†åæ–‡æœ¬</span>
console.log(result.text);  <span class="code-comment">// è¾“å‡º: ä»Šå¤©çœŸæ˜¯ = =</span>
console.log(result.successCount);  <span class="code-comment">// æˆåŠŸæ›¿æ¢æ•°é‡</span></code></pre>
        <button onclick="testReplace()">è¿è¡Œæ›¿æ¢ç¤ºä¾‹</button>
        <div class="output" id="replace-output">ç‚¹å‡»æŒ‰é’®è¿è¡Œ...</div>
    </div>

    <!-- CRUD æ“ä½œ -->
    <div class="section">
        <h2>4ï¸âƒ£ CRUD æ“ä½œç¤ºä¾‹</h2>

        <h3>ğŸ“ Create - æ·»åŠ æ–°é¢œæ–‡å­—</h3>
        <pre><code>const manager = KaomojiReplacer.createManager(kaomojis);
manager.addKaomoji({
    kaomoji: '(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§',
    keywords: ['åŠ æ²¹', 'åŠªåŠ›', 'å¥‹æ–—'],
    weight: 1.0,
    category: 'é¼“åŠ±'
});
const newData = manager.getAllKaomojis();</code></pre>
        <button onclick="testCreate()">è¿è¡Œ Create</button>
        <div class="output" id="create-output">ç‚¹å‡»æŒ‰é’®è¿è¡Œ...</div>

        <h3>ğŸ“– Read - è¯»å–æ•°æ®</h3>
        <pre><code><span class="code-comment">// ä» IndexedDB è¯»å–</span>
const cachedData = await KaomojiReplacer.getKaomojis();

<span class="code-comment">// è·å–æ‰€æœ‰é¢œæ–‡å­—</span>
const allKaomojis = manager.getAllKaomojis();

<span class="code-comment">// æŒ‰å…³é”®è¯æŸ¥æ‰¾</span>
const found = manager.findByKeyword('å¼€å¿ƒ');

<span class="code-comment">// æŒ‰åˆ†ç±»ç­›é€‰</span>
const filtered = manager.filterByCategory('è¡¨æƒ…');</code></pre>
        <button onclick="testRead()">è¿è¡Œ Read</button>
        <div class="output" id="read-output">ç‚¹å‡»æŒ‰é’®è¿è¡Œ...</div>

        <h3>âœï¸ Update - æ›´æ–°æ•°æ®</h3>
        <pre><code><span class="code-comment">// æ·»åŠ å…³é”®è¯</span>
manager.addKeyword('= =', 'æ— å¥ˆ');

<span class="code-comment">// åˆ é™¤å…³é”®è¯</span>
manager.removeKeyword('= =', 'é»‘è„¸');

<span class="code-comment">// æ‰¹é‡æ›´æ–°å…³é”®è¯</span>
manager.updateKeywords('= =', ['æ— è¯­', 'æ— å¥ˆ', 'å†·æ¼ ']);

<span class="code-comment">// è®¾ç½®åˆ†ç±»å’Œæƒé‡</span>
manager.setCategory('= =', 'è¡¨æƒ…');
manager.setWeight('= =', 1.2);</code></pre>
        <button onclick="testUpdate()">è¿è¡Œ Update</button>
        <div class="output" id="update-output">ç‚¹å‡»æŒ‰é’®è¿è¡Œ...</div>

        <h3>ğŸ—‘ï¸ Delete - åˆ é™¤æ•°æ®</h3>
        <pre><code><span class="code-comment">// åˆ é™¤æŒ‡å®šé¢œæ–‡å­—</span>
manager.removeKaomoji('(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§');

<span class="code-comment">// æ¸…ç©º IndexedDB ç¼“å­˜</span>
await KaomojiReplacer.clearKaomojis();</code></pre>
        <button onclick="testDelete()">è¿è¡Œ Delete</button>
        <div class="output" id="delete-output">ç‚¹å‡»æŒ‰é’®è¿è¡Œ...</div>
    </div>

    <!-- Step 5: å®Œæ•´ç¤ºä¾‹ -->
    <div class="section">
        <h2>5ï¸âƒ£ å®Œæ•´ç¤ºä¾‹ï¼šå®é™…ä½¿ç”¨</h2>
        <pre><code><span class="code-comment">// å®Œæ•´æµç¨‹</span>
async function main() {
    <span class="code-comment">// 1. åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨å¤„ç† CDN å’Œ IndexedDBï¼‰</span>
    const kaomojis = await KaomojiReplacer.initKaomojiStorage({
        defaultURL: 'https://cdn.jsdelivr.net/npm/kaomoji-replacer/data/kaomojis.template.json'
    });

    <span class="code-comment">// 2. åˆ›å»ºæ›¿æ¢å™¨</span>
    const replacer = KaomojiReplacer.createReplacer({ kaomojis });

    <span class="code-comment">// 3. ä½¿ç”¨</span>
    const text = 'ä»Šå¤©[kaomoji:å¼€å¿ƒ]åˆå­¦ä¼šäº†æ–°æŠ€èƒ½ï¼';
    const result = replacer.replaceText(text);
    console.log(result.text);
}</code></pre>
        <button onclick="runFullExample()">è¿è¡Œå®Œæ•´ç¤ºä¾‹</button>
        <div class="output" id="full-output">ç‚¹å‡»æŒ‰é’®è¿è¡Œ...</div>
    </div>

    <!-- å¼•å…¥æœ¬åœ° UMD æ–‡ä»¶ç”¨äºæ¼”ç¤º -->
    <script src="../dist/kaomoji-replacer.umd.min.js"></script>

    <script>
        let replacer = null;
        let manager = null;
        let kaomojis = null;

        // 2. åˆå§‹åŒ–
        async function init() {
            try {
                // ä½¿ç”¨æœ¬åœ°æ•°æ®æ–‡ä»¶ï¼ˆå®é™…é¡¹ç›®ä¸­ä½¿ç”¨ CDNï¼‰
                kaomojis = await KaomojiReplacer.initKaomojiStorage({
                    defaultURL: '../data/kaomojis.template.json'
                });

                replacer = KaomojiReplacer.createReplacer({ kaomojis });
                manager = KaomojiReplacer.createManager(kaomojis);

                document.getElementById('init-output').innerHTML =
                    `âœ… åˆå§‹åŒ–æˆåŠŸï¼<br>` +
                    `åŠ è½½äº† ${kaomojis.length} ä¸ªé¢œæ–‡å­—<br>` +
                    `æ•°æ®å·²ç¼“å­˜åˆ° IndexedDB`;
            } catch (error) {
                document.getElementById('init-output').textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // 3. æ–‡æœ¬æ›¿æ¢
        function testReplace() {
            if (!replacer) {
                document.getElementById('replace-output').innerHTML = 'âŒ è¯·å…ˆè¿è¡Œåˆå§‹åŒ–';
                return;
            }

            const input1 = 'ä»Šå¤©çœŸæ˜¯[kaomoji:æ— è¯­,é»‘è„¸]';
            const result1 = replacer.replaceText(input1);

            const input2 = 'å¤ª[kaomoji:å¼€å¿ƒ,é«˜å…´]äº†ï¼æƒ³[kaomoji:åº†ç¥]ä¸€ä¸‹';
            const result2 = replacer.replaceText(input2);

            document.getElementById('replace-output').innerHTML =
                `<strong>ç¤ºä¾‹ 1:</strong><br>` +
                `è¾“å…¥: ${input1}<br>` +
                `è¾“å‡º: ${result1.text}<br>` +
                `æˆåŠŸ: ${result1.successCount} / å¤±è´¥: ${result1.failureCount}<br><br>` +
                `<strong>ç¤ºä¾‹ 2:</strong><br>` +
                `è¾“å…¥: ${input2}<br>` +
                `è¾“å‡º: ${result2.text}<br>` +
                `æˆåŠŸ: ${result2.successCount} / å¤±è´¥: ${result2.failureCount}`;
        }

        // 4. Create
        function testCreate() {
            if (!manager) {
                document.getElementById('create-output').innerHTML = 'âŒ è¯·å…ˆè¿è¡Œåˆå§‹åŒ–';
                return;
            }

            const beforeCount = manager.getAllKaomojis().length;

            manager.addKaomoji({
                kaomoji: '(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§',
                keywords: ['åŠ æ²¹', 'åŠªåŠ›', 'å¥‹æ–—'],
                weight: 1.0,
                category: 'é¼“åŠ±'
            });

            const afterCount = manager.getAllKaomojis().length;
            const newKaomoji = manager.findByKeyword('åŠ æ²¹')[0];

            if (!newKaomoji) {
                document.getElementById('create-output').innerHTML = 'âŒ åˆ›å»ºåæœªèƒ½æ‰¾åˆ°æ–°é¢œæ–‡å­—';
                return;
            }

            document.getElementById('create-output').innerHTML =
                `âœ… æ·»åŠ æˆåŠŸï¼<br>` +
                `æ·»åŠ å‰: ${beforeCount} ä¸ª<br>` +
                `æ·»åŠ å: ${afterCount} ä¸ª<br>` +
                `æ–°é¢œæ–‡å­—: ${newKaomoji.kaomoji}<br>` +
                `å…³é”®è¯: ${newKaomoji.keywords.join(', ')}`;
        }

        // 4. Read
        async function testRead() {
            if (!manager) {
                document.getElementById('read-output').innerHTML = 'âŒ è¯·å…ˆè¿è¡Œåˆå§‹åŒ–';
                return;
            }

            // ä» IndexedDB è¯»å–
            const cachedData = await KaomojiReplacer.getKaomojis();

            // è·å–æ‰€æœ‰æ•°æ®
            const allKaomojis = manager.getAllKaomojis();

            // æŒ‰å…³é”®è¯æŸ¥æ‰¾
            const foundByKeyword = manager.findByKeyword('å¼€å¿ƒ');

            // è·å–ç‰¹å®šé¢œæ–‡å­—çš„å…³é”®è¯
            const keywords = manager.getKeywordsByKaomoji('= =');

            document.getElementById('read-output').innerHTML =
                `âœ… è¯»å–æˆåŠŸï¼<br>` +
                `IndexedDB ä¸­æœ‰æ•°æ®: ${cachedData ? 'æ˜¯' : 'å¦'}<br>` +
                `æ€»é¢œæ–‡å­—æ•°: ${allKaomojis.length}<br>` +
                `å…³é”®è¯"å¼€å¿ƒ"åŒ¹é…åˆ°: ${foundByKeyword.length} ä¸ª<br>` +
                `"= ="çš„å…³é”®è¯: ${keywords.join(', ')}`;
        }

        // 4. Update
        function testUpdate() {
            if (!manager) {
                document.getElementById('update-output').innerHTML = 'âŒ è¯·å…ˆè¿è¡Œåˆå§‹åŒ–';
                return;
            }

            const kaomoji = '= =';
            const before = [...manager.getKeywordsByKaomoji(kaomoji)];

            // æ·»åŠ å…³é”®è¯
            manager.addKeyword(kaomoji, 'æ— å¥ˆ');
            const afterAdd = [...manager.getKeywordsByKaomoji(kaomoji)];

            // è®¾ç½®åˆ†ç±»å’Œæƒé‡
            manager.setCategory(kaomoji, 'è¡¨æƒ…');
            manager.setWeight(kaomoji, 1.5);

            const kaomojiData = manager.findByKeyword('æ— è¯­')[0];

            if (!kaomojiData) {
                document.getElementById('update-output').innerHTML = 'âŒ æœªèƒ½æ‰¾åˆ°é¢œæ–‡å­—æ•°æ®';
                return;
            }

            document.getElementById('update-output').innerHTML =
                `âœ… æ›´æ–°æˆåŠŸï¼<br>` +
                `æ›´æ–°å‰å…³é”®è¯: ${before.join(', ')}<br>` +
                `æ·»åŠ "æ— å¥ˆ"å: ${afterAdd.join(', ')}<br>` +
                `å½“å‰åˆ†ç±»: ${kaomojiData.category}<br>` +
                `å½“å‰æƒé‡: ${kaomojiData.weight}`;
        }

        // 4. Delete
        async function testDelete() {
            if (!manager) {
                document.getElementById('delete-output').innerHTML = 'âŒ è¯·å…ˆè¿è¡Œåˆå§‹åŒ–';
                return;
            }

            const testKaomoji = '(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§';
            const before = manager.getAllKaomojis().length;

            // åˆ é™¤é¢œæ–‡å­—
            const deleted = manager.removeKaomoji(testKaomoji);
            const after = manager.getAllKaomojis().length;

            // è·å–ç¼“å­˜çŠ¶æ€
            const stats = await KaomojiReplacer.getStorageStats();

            document.getElementById('delete-output').innerHTML =
                `âœ… åˆ é™¤æ“ä½œå®Œæˆï¼<br>` +
                `åˆ é™¤ "${testKaomoji}": ${deleted ? 'æˆåŠŸ' : 'æœªæ‰¾åˆ°'}<br>` +
                `åˆ é™¤å‰: ${before} ä¸ª<br>` +
                `åˆ é™¤å: ${after} ä¸ª<br>` +
                `IndexedDB ç¼“å­˜: ${stats.count} ä¸ª, ${stats.sizeKB} KB`;
        }

        // 5. å®Œæ•´ç¤ºä¾‹
        async function runFullExample() {
            try {
                // 1. åˆå§‹åŒ–
                const data = await KaomojiReplacer.initKaomojiStorage({
                    defaultURL: '../data/kaomojis.template.json'
                });

                // 2. åˆ›å»ºæ›¿æ¢å™¨
                const r = KaomojiReplacer.createReplacer({ kaomojis: data });

                // 3. ä½¿ç”¨
                const texts = [
                    'ä»Šå¤©[kaomoji:å¼€å¿ƒ,é«˜å…´]åˆå­¦ä¼šäº†æ–°æŠ€èƒ½ï¼',
                    'é‡åˆ°bugçœŸæ˜¯[kaomoji:æ— è¯­,é»‘è„¸]',
                    'ç»ˆäºè§£å†³äº†ï¼Œæƒ³[kaomoji:åº†ç¥,å¼€å¿ƒ]'
                ];

                const results = texts.map(t => ({
                    input: t,
                    output: r.replaceText(t).text
                }));

                let output = 'âœ… å®Œæ•´æµç¨‹æ‰§è¡ŒæˆåŠŸï¼<br><br>';
                results.forEach((r, i) => {
                    output += `<strong>ç¤ºä¾‹ ${i + 1}:</strong><br>`;
                    output += `è¾“å…¥: ${r.input}<br>`;
                    output += `è¾“å‡º: ${r.output}<br><br>`;
                });

                document.getElementById('full-output').innerHTML = output;
            } catch (error) {
                document.getElementById('full-output').innerHTML =
                    `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæç¤º
        console.log('Kaomoji Replacer UMD ç‰ˆæœ¬:', KaomojiReplacer.VERSION);
        console.log('å¯ç”¨ API:', Object.keys(KaomojiReplacer));
    </script>
</body>
</html>
