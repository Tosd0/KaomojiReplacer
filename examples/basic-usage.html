<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoticon Replacer - åŸºç¡€ä½¿ç”¨ç¤ºä¾‹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #666;
            padding-bottom: 10px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 5px;
        }
        .input-area, .output-area {
            margin: 15px 0;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .output {
            background: white;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 3px;
            min-height: 50px;
            white-space: pre-wrap;
            font-size: 16px;
        }
        .stats {
            color: #666;
            font-size: 12px;
            margin-top: 10px;
        }
        .example-text {
            color: #0066cc;
            cursor: pointer;
            text-decoration: underline;
        }
        .query-section {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .query-section input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .results {
            background: white;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin-top: 10px;
        }
        .result-item {
            padding: 8px;
            margin: 5px 0;
            background: #f9f9f9;
            border-left: 3px solid #4CAF50;
        }
    </style>
</head>
<body>
    <h1>ğŸ­ Emoticon Replacer - åŸºç¡€ä½¿ç”¨ç¤ºä¾‹</h1>

    <div class="section">
        <h2>ğŸ“ æ–‡æœ¬æ›¿æ¢æ¼”ç¤º</h2>
        <div class="input-area">
            <label><strong>è¾“å…¥æ–‡æœ¬ï¼ˆåŒ…å« [emoticon:...] æ ‡è®°ï¼‰ï¼š</strong></label>
            <textarea id="inputText">ä»Šå¤©çœŸæ˜¯å¤ª[emoticon:æ— è¯­,é»‘è„¸]äº†ï¼Œä¸è¿‡è¿˜æ˜¯å¾ˆ[emoticon:å¼€å¿ƒ,é«˜å…´]çš„ã€‚è™½ç„¶æƒ³[emoticon:æ€æ¡Œ,æ„¤æ€’]ï¼Œä½†è¿˜æ˜¯å†³å®š[emoticon:èººå¹³,æ‘†çƒ‚]ç®—äº†ã€‚</textarea>
            <div style="margin-top: 10px;">
                <span class="example-text" onclick="loadExample1()">ç¤ºä¾‹1</span> |
                <span class="example-text" onclick="loadExample2()">ç¤ºä¾‹2</span> |
                <span class="example-text" onclick="loadExample3()">ç¤ºä¾‹3</span>
            </div>
        </div>

        <div>
            <button onclick="processText()">ğŸ”„ æ‰§è¡Œæ›¿æ¢</button>
            <button onclick="previewText()">ğŸ‘ï¸ é¢„è§ˆåŒ¹é…</button>
            <button onclick="clearOutput()">ğŸ—‘ï¸ æ¸…ç©º</button>
        </div>

        <div class="output-area">
            <label><strong>è¾“å‡ºç»“æœï¼š</strong></label>
            <div id="output" class="output">ç­‰å¾…å¤„ç†...</div>
            <div id="stats" class="stats"></div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ” å…³é”®è¯æŸ¥è¯¢</h2>
        <div class="query-section">
            <input type="text" id="queryInput" placeholder="è¾“å…¥å…³é”®è¯ï¼Œä¾‹å¦‚ï¼šå¼€å¿ƒã€æ— è¯­ã€ç”Ÿæ°”..." />
            <button onclick="searchKeyword()">æœç´¢</button>
            <button onclick="exactSearch()">ç²¾ç¡®æœç´¢</button>
        </div>
        <div id="queryResults" class="results"></div>
    </div>

    <div class="section">
        <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
        <div id="statsInfo" class="output"></div>
    </div>

    <!-- åŠ è½½æ ¸å¿ƒæ¨¡å— -->
    <script src="../src/core/SearchEngine.js"></script>
    <script src="../src/core/EmoticonReplacer.js"></script>
    <script src="../src/core/EmoticonDataManager.js"></script>

    <script>
        // åˆå§‹åŒ–
        let replacer = null;

        async function init() {
            try {
                // åˆ›å»ºæ•°æ®ç®¡ç†å™¨
                const manager = new EmoticonDataManager();

                // ä»æ–‡ä»¶åŠ è½½æ•°æ®
                const response = await fetch('../data/emoticons.template.json');
                const jsonText = await response.text();
                manager.loadFromJSON(jsonText);

                // åˆ›å»ºæœç´¢å¼•æ“å’Œæ›¿æ¢å™¨
                const searchEngine = new SearchEngine();
                replacer = new EmoticonReplacer(searchEngine);
                replacer.loadEmoticons(manager.getAllEmoticons());

                console.log('Initialized successfully');
                const stats = manager.getStats();
                document.getElementById('statsInfo').textContent =
                    `å·²åŠ è½½ ${stats.totalEmoticons} ä¸ªé¢œæ–‡å­—\n` +
                    `æ€»å…³é”®è¯æ•°é‡: ${stats.totalKeywords}\n` +
                    `å¹³å‡å…³é”®è¯æ•°é‡: ${stats.averageKeywordsPerEmoticon}`;

            } catch (error) {
                console.error('Initialization failed:', error);
                alert('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        // å¤„ç†æ–‡æœ¬
        function processText() {
            if (!replacer) {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
                return;
            }

            const input = document.getElementById('inputText').value;
            const result = replacer.replaceText(input, {
                strategy: 'best',
                keepOriginalOnNotFound: true,
                markNotFound: false
            });

            document.getElementById('output').textContent = result.text;
            document.getElementById('stats').textContent =
                `æˆåŠŸæ›¿æ¢: ${result.successCount} | å¤±è´¥: ${result.failureCount} | æ€»è®¡: ${result.replacements.length}`;

            console.log('Replacement details:', result.replacements);
        }

        // é¢„è§ˆåŒ¹é…
        function previewText() {
            if (!replacer) {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
                return;
            }

            const input = document.getElementById('inputText').value;
            const preview = replacer.preview(input);

            let output = 'é¢„è§ˆç»“æœ:\n\n';
            preview.forEach((item, index) => {
                output += `${index + 1}. æ ‡è®°: ${item.marker}\n`;
                output += `   å…³é”®è¯: ${item.keywords.join(', ')}\n`;
                if (item.bestMatch) {
                    output += `   æœ€ä½³åŒ¹é…: ${item.bestMatch.emoticon} (åˆ†æ•°: ${item.bestMatch.score.toFixed(2)})\n`;
                    output += `   åŒ¹é…å…³é”®è¯: ${item.bestMatch.matchedKeywords.join(', ')}\n`;
                } else {
                    output += `   âŒ æœªæ‰¾åˆ°åŒ¹é…\n`;
                }
                output += '\n';
            });

            document.getElementById('output').textContent = output || 'æ²¡æœ‰æ‰¾åˆ°æ ‡è®°';
            document.getElementById('stats').textContent = `æ‰¾åˆ° ${preview.length} ä¸ªæ ‡è®°`;
        }

        // æœç´¢å…³é”®è¯
        function searchKeyword() {
            if (!replacer) {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
                return;
            }

            const query = document.getElementById('queryInput').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥å…³é”®è¯');
                return;
            }

            const results = replacer.query(query, 10);
            displayQueryResults(results, 'æ¨¡ç³Šæœç´¢');
        }

        // ç²¾ç¡®æœç´¢
        function exactSearch() {
            if (!replacer) {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
                return;
            }

            const query = document.getElementById('queryInput').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥å…³é”®è¯');
                return;
            }

            const results = replacer.exactQuery(query);
            displayQueryResults(results, 'ç²¾ç¡®æœç´¢');
        }

        // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
        function displayQueryResults(results, searchType) {
            const container = document.getElementById('queryResults');

            if (results.length === 0) {
                container.innerHTML = '<p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¢œæ–‡å­—</p>';
                return;
            }

            let html = `<p><strong>${searchType}ç»“æœ (${results.length} ä¸ª)ï¼š</strong></p>`;
            results.forEach((result, index) => {
                html += `
                    <div class="result-item">
                        <div style="font-size: 24px; margin-bottom: 5px;">${result.emoticon}</div>
                        <div><strong>åˆ†æ•°:</strong> ${result.score.toFixed(2)}</div>
                        <div><strong>åŒ¹é…å…³é”®è¯:</strong> ${result.matchedKeywords.join(', ')}</div>
                        <div><strong>åˆ†ç±»:</strong> ${result.category}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // æ¸…ç©ºè¾“å‡º
        function clearOutput() {
            document.getElementById('output').textContent = 'ç­‰å¾…å¤„ç†...';
            document.getElementById('stats').textContent = '';
        }

        // ç¤ºä¾‹æ–‡æœ¬
        function loadExample1() {
            document.getElementById('inputText').value =
                'ä»Šå¤©çœŸæ˜¯å¤ª[emoticon:æ— è¯­,é»‘è„¸]äº†ï¼Œä¸è¿‡è¿˜æ˜¯å¾ˆ[emoticon:å¼€å¿ƒ,é«˜å…´]çš„ã€‚è™½ç„¶æƒ³[emoticon:æ€æ¡Œ,æ„¤æ€’]ï¼Œä½†è¿˜æ˜¯å†³å®š[emoticon:èººå¹³,æ‘†çƒ‚]ç®—äº†ã€‚';
        }

        function loadExample2() {
            document.getElementById('inputText').value =
                'é¢å¯¹è¿™ä¸ªé—®é¢˜æˆ‘è¡¨ç¤º[emoticon:ç–‘æƒ‘,ä¸è§£]ï¼Œéœ€è¦[emoticon:è®¤çœŸ,ä¸¥è‚ƒ]æ€è€ƒä¸€ä¸‹ã€‚ç»“æœè®©æˆ‘å¾ˆ[emoticon:æƒŠè®¶,éœ‡æƒŠ]ï¼';
        }

        function loadExample3() {
            document.getElementById('inputText').value =
                'çœ‹åˆ°ä»–çš„å›å¤ï¼Œæˆ‘åªæƒ³è¯´[emoticon:é„™è§†,ä¸å±‘]ã€‚ç®—äº†ï¼Œè¿˜æ˜¯å»[emoticon:è®°ç¬”è®°,è®°å½•]å§ï¼Œä¸ç„¶åˆè¦[emoticon:éš¾è¿‡,ä¼¤å¿ƒ]äº†ã€‚';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
